
| Типы памяти                      | Где хранится? | Пример данных                               |
| -------------------------------- | ------------- | ------------------------------------------- |
| Статическая память (.data, .bss) | ОЗУ (RAM)     | Глобальные и статические переменные         |
| Куча (Heap)                      | ОЗУ (RAM)     | Динамическое выделенные переменные (malloc) |
| Стек (Stack)                     | ОЗУ (RAM)     | Локальные переменные, параметры функций     |
| Flash ROM (ПЗУ)                  | ПЗУ (ROM)     | Код программы, константы (const)            |
**Сегмент .data**
Переменные, которые имеют начальное значение, попадают в сегмент **.data** и загружаются в RAM из Flash при старте программы.
```C
int global_var = 10;  // Хранится в .data
static int static_var = 20;  // Тоже .data
```
**Сегмент .bss**
Переменные без начального значения хранятся в **.bss** и обнуляются при старте.
```C
int uninit_global;  // Хранится в .bss, обнуляется при старте
static int uninit_static;  // Тоже .bss
```
---
**Стек (Stack)**
Стек используется для хранения локальных переменных и вызовов функций.
При вызове функции выделяется память в стеке, когда функция завершается, стек освобождается. Стек растет вниз (от более высоких адресов к низким).
Стек может быть переполняться в случае, если функция вызывается рекурсивно и не имеет базового случая, при котором будет осуществлен выход.
**Куча (Heap)**
Область памяти, где данные выделяются во время выполнения программы.
```C
int *ptr = (int*) malloc(sizeof(int));  // Выделяем 4 байта
if (ptr) {
    *ptr = 42;
    free(ptr);  // Освобождаем память
}
```
###### Оптимизация использования памяти
- Использование const для неизменных данных
``` C
const char message[] = "Stored in Flash!";
```
- Выделять большие массивы статически (.bss)
```C
static uint8_t buffer[1024];  // Будет в RAM, но без проблем фрагментации
```
- Контролировать размер стека
```C
#define STACK_SIZE 2048
__attribute__((section(".stack"))) uint8_t stack_memory[STACK_SIZE];
```
- Не использовать malloc() без необходимости
- Выравнивание памяти (оптимизация работы кэша процессора)
```C
struct __attribute__((aligned(4))) Data {
    uint8_t a;
    uint32_t b;
};
```
---
###### Куча (Heap)
Куча - область памяти, где данные выделяются во время выполнения программы.
Для выделения памяти под переменные неизвестного размера можно использовать функции malloc() и free()
```C
int *ptr = (int*) malloc(sizeof(int));  // Выделяем 4 байта
if (ptr) {
    *ptr = 42;
    free(ptr);  // Освобождаем память
}
```
